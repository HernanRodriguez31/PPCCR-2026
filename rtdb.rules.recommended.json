{
  "rules": {
    "ppccr": {
      "teleconsulta": {
        ".read": "auth != null",
        ".write": "auth != null",
        "roomLocks": {
          ".read": false,
          ".write": false
        },
        "presence": {
          "$stationId": {
            ".validate": "$stationId.matches(/^(saavedra|rivadavia|aristobulo|chacabuco|admin)$/)",
            "online": {
              ".validate": "newData.isBoolean()"
            },
            "busy": {
              ".validate": "newData.isBoolean()"
            },
            "name": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 80"
            },
            "ts": {
              ".validate": "newData.isNumber()"
            },
            "$other": {
              ".validate": false
            }
          }
        },
        "calls": {
          "$toStationId": {
            ".validate": "$toStationId.matches(/^(saavedra|rivadavia|aristobulo|chacabuco|admin)$/)",
            "$callId": {
              ".validate": "newData.hasChildren(['callId','fromId','toId','status','room','createdAt','updatedAt'])",
              "callId": {
                ".validate": "newData.isString() && newData.val() === $callId"
              },
              "fromId": {
                ".validate": "newData.isString() && newData.val().matches(/^(saavedra|rivadavia|aristobulo|chacabuco|admin)$/)"
              },
              "toId": {
                ".validate": "newData.isString() && newData.val() === $toStationId"
              },
              "fromName": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 80"
              },
              "toName": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 80"
              },
              "room": {
                ".validate": "newData.isString() && newData.val().length >= 8 && newData.val().length <= 140"
              },
              "status": {
                ".validate": "newData.isString() && newData.val().matches(/^(ringing|queued|accepted|in-call|declined|cancelled|ended|missed|timeout)$/)"
              },
              "createdAt": {
                ".validate": "newData.isNumber()"
              },
              "updatedAt": {
                ".validate": "newData.isNumber()"
              },
              "acceptedAt": {
                ".validate": "!newData.exists() || newData.isNumber()"
              },
              "endedAt": {
                ".validate": "!newData.exists() || newData.isNumber()"
              },
              "reason": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 120)"
              },
              "$other": {
                ".validate": false
              }
            }
          }
        },
        "chat": {
          "global": {
            "messages": {
              "$messageId": {
                ".validate": "newData.hasChildren(['ts','stationId','stationName','authorName','type'])",
                "ts": {
                  ".validate": "newData.isNumber()"
                },
                "stationId": {
                  ".validate": "newData.isString() && newData.val().matches(/^(saavedra|rivadavia|aristobulo|chacabuco|admin)$/)"
                },
                "stationName": {
                  ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 80"
                },
                "authorName": {
                  ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 40"
                },
                "type": {
                  ".validate": "newData.isString() && newData.val().matches(/^(text|call_request|call_queue|system)$/)"
                },
                "text": {
                  ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 300)"
                },
                "request": {
                  "fromStationId": {
                    ".validate": "!newData.exists() || (newData.isString() && newData.val().matches(/^(saavedra|rivadavia|aristobulo|chacabuco|admin)$/))"
                  },
                  "fromStationName": {
                    ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 80)"
                  },
                  "toStationId": {
                    ".validate": "!newData.exists() || (newData.isString() && newData.val().matches(/^(saavedra|rivadavia|aristobulo|chacabuco|admin)$/))"
                  },
                  "toStationName": {
                    ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 80)"
                  },
                  "status": {
                    ".validate": "!newData.exists() || (newData.isString() && newData.val().matches(/^(pending|called)$/))"
                  },
                  "calledByStationId": {
                    ".validate": "!newData.exists() || (newData.isString() && newData.val().matches(/^(|saavedra|rivadavia|aristobulo|chacabuco|admin)$/))"
                  },
                  "calledAt": {
                    ".validate": "!newData.exists() || newData.isNumber()"
                  },
                  "callId": {
                    ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 80)"
                  },
                  "$other": {
                    ".validate": false
                  }
                },
                "$other": {
                  ".validate": false
                }
              }
            }
          }
        }
      }
    }
  }
}
