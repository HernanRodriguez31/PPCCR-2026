{
  "rules": {
    "ppccr": {
      "teleconsulta": {
        ".read": "auth != null",
        ".write": "auth != null",
        "presence": {
          "$stationId": {
            ".validate": "$stationId.matches(/^(saavedra|rivadavia|aristobulo|chacabuco|admin)$/)",
            "online": {
              ".validate": "newData.isBoolean()"
            },
            "busy": {
              ".validate": "!newData.exists() || newData.isBoolean()"
            },
            "stationName": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 80"
            },
            "role": {
              ".validate": "newData.isString() && newData.val().matches(/^(station|medic)$/)"
            },
            "ts": {
              ".validate": "newData.isNumber()"
            }
          }
        },
        "calls": {
          "$toStationId": {
            ".validate": "$toStationId.matches(/^(saavedra|rivadavia|aristobulo|chacabuco|admin)$/)",
            "$callId": {
              ".validate": "newData.hasChildren(['callId','fromId','toId','fromName','toName','status','room','hostId','callerRole','targetRole','createdAt','updatedAt'])",
              "callId": {
                ".validate": "newData.isString() && newData.val() === $callId"
              },
              "fromId": {
                ".validate": "newData.isString() && newData.val().matches(/^(saavedra|rivadavia|aristobulo|chacabuco|admin)$/)"
              },
              "toId": {
                ".validate": "newData.isString() && newData.val() === $toStationId"
              },
              "fromName": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 80"
              },
              "toName": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 80"
              },
              "room": {
                ".validate": "newData.isString() && newData.val().length >= 8 && newData.val().length <= 140"
              },
              "hostId": {
                ".validate": "newData.isString() && newData.val().matches(/^(saavedra|rivadavia|aristobulo|chacabuco|admin)$/)"
              },
              "callerRole": {
                ".validate": "newData.isString() && newData.val().matches(/^(station|medic)$/)"
              },
              "targetRole": {
                ".validate": "newData.isString() && newData.val().matches(/^(station|medic)$/)"
              },
              "status": {
                ".validate": "newData.isString() && newData.val().matches(/^(ringing|calling|queued|accepted|in-call|declined|cancelled|ended|missed|timeout)$/)"
              },
              "createdAt": {
                ".validate": "newData.isNumber()"
              },
              "updatedAt": {
                ".validate": "newData.isNumber()"
              },
              "acceptedAt": {
                ".validate": "!newData.exists() || newData.isNumber()"
              },
              "endedAt": {
                ".validate": "!newData.exists() || newData.isNumber()"
              },
              "reason": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 120)"
              },
              "$other": {
                ".validate": false
              }
            }
          }
        },
        "chat": {
          "messages": {
            "$messageId": {
              ".validate": "newData.hasChildren(['ts','type','stationId','stationName','authorName'])",
              "ts": {
                ".validate": "newData.isNumber()"
              },
              "type": {
                ".validate": "newData.isString() && newData.val().matches(/^(text|call_request|system)$/)"
              },
              "stationId": {
                ".validate": "newData.isString() && newData.val().matches(/^(saavedra|rivadavia|aristobulo|chacabuco|admin)$/)"
              },
              "stationName": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 80"
              },
              "authorName": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 40"
              },
              "text": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 500)"
              },
              "requestStatus": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().matches(/^(pending|queued|called|done)$/))"
              },
              "handledBy": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().matches(/^(saavedra|rivadavia|aristobulo|chacabuco|admin)$/))"
              },
              "handledByName": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 80)"
              },
              "handledAt": {
                ".validate": "!newData.exists() || newData.isNumber()"
              },
              "targetId": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().matches(/^(saavedra|rivadavia|aristobulo|chacabuco|admin)$/))"
              },
              "callId": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 80)"
              },
              "$other": {
                ".validate": false
              }
            }
          }
        }
      }
    }
  }
}
